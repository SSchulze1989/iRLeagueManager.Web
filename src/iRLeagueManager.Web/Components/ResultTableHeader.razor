@typeparam TRow

<th class="table-header
        pa-1
        @(Active ? "active" : "" )
        @(HasAction ? "action" : "")
        @(CurrentDirection == ViewModels.SortDirection.Ascending ? "sort-ascending" : "sort-descending")
    "
    @onclick=@OnClick>
    <MudStack Row="true" AlignItems="AlignItems.Center" Class="pa-0">
        @Text
        <MudIcon Icon="@(CurrentDirection == ViewModels.SortDirection.Ascending ? Icons.Material.Filled.KeyboardArrowUp : Icons.Material.Filled.KeyboardArrowDown)" Class="table-header-adorner"/>
    </MudStack>
</th>

@code {
    [CascadingParameter]
    public SortState<TRow> CascadingSortState { get; set; } = default!;
    [Parameter]
    public string Text { get; set; } = string.Empty;
    [Parameter]
    public Func<TRow, IComparable>? Sort { get; set; }
    [Parameter]
    public bool Default { get; set; } = false;
    [Parameter]
    public ViewModels.SortDirection Direction { get; set; } = ViewModels.SortDirection.Ascending;

    private ViewModels.SortDirection CurrentDirection { get; set; }

    private bool Active => CascadingSortState.SortFunc == Sort && HasAction;

    private bool HasAction => Sort is not null;

    protected override void OnInitialized()
    {
        CurrentDirection = Direction;
        if (Default)
        {
            OnClick();
        }
    }

    protected override void OnParametersSet()
    {
        BlazorParameterNullException.ThrowIfNull(this, CascadingSortState);
    }

    private void OnClick()
    {
        if (HasAction == false)
        {
            return;
        }

        if (Active)
        {
            CurrentDirection = CurrentDirection == ViewModels.SortDirection.Ascending ? ViewModels.SortDirection.Descending : ViewModels.SortDirection.Ascending;
        }

        CascadingSortState.Direction = CurrentDirection;
        CascadingSortState.SortFunc = Sort;
    }
}
